## cidrips

[![en](https://img.shields.io/badge/lang-en-red.svg)](https://github.com/grutenko/cidrips/blob/master/README.en.md)
[![ru](https://img.shields.io/badge/lang-ru-green.svg)](https://github.com/grutenko/cidrips/blob/master/README.md)

_Утилита сжатия списка IP адресов с исползованием группировки по CIDR маске_

### Как использовать

Утилита может работать в двух режимах:

1. --mode=level - Группирует так, чтобы любая маска результа содержала не менее $weight(cidr) / 2^{level}$ исходных адресов. То есть для --level = 0 : $weight(cidr) / 2^0 = weight(cidr) = 100\%$ адресов
2. --mode=count - Находит наиболее подходящее значение level чтобы резальтат содержал не более count адресов

Вне зависимости от выбраного режима проводится некоторая предварительная работа с адресами:

1. Удаляются дублирующие адреса
2. удаляются адреса и так входящие в одну из масок: 127.0.0.0/31, 127.0.0.1 => 127.0.0.0/31
3. Результат сортируется по возрастанию чисел в адресе.

#### Основные опции

1. -i,--input - входной поток. Путь к файлу или "-" для чтения из входного потока
2. -o,--out - выходной поток.  Путь к файлу или "-" для чтения из входного потока
3. -m,--mode - режим работы. "level" или "count"
4. -l,--level - уровень сжатия (для --mode=level)
5. -c,--count - максимальное количество в результате (для --mode=count)

#### Другие опции

1. --overwrite, --append, --cancel - что делать в случае если выходной файл существует и не пуст. Если один из этих параметров отсутсвует будет задан соответствующий вопрос
2. --no-stats - не выводить статистику в выходной поток
3. --prefix - добавить эту строку перед каждый выходным адресом (доступны \t\r\n как управляющие последовательности)
4. --postfix - добавить эту строку каждого выходного адреса (доступны \t\r\n как управляющие последовательности) (По умолчанию "\n")

### Пример

```bat
cidrips.exe -iips.txt -osubnets.txt -mlevel --level=0
```

```
# ips.txt
127.0.0.1
127.0.0.2
127.0.0.3
127.0.0.4
```

```
# subnets.txt
127.0.0.1
127.0.0.2/31
127.0.0.4
```

```
# stats
coverage=4, source=4, falsely_covered=0.000000%; result=3, compress=25.000000%
```

### Загрузка

windows, linux, macos (x86_64) 

с.м. [Релизы](https://github.com/grutenko/cidrips/releases/latest)

ARM только сборка из исходников

### Сборка

```bat
cmake -DCMAKE_BUILD_TYPE=Release -S . -B build
cmake --build build
```